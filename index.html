<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Baby Word Scramble</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#fff7fb;
      --bg2:#f3fbff;
      --ink:#1f2937;
      --muted:#6b7280;
      --card:#ffffff;
      --line:#e5e7eb;
      --pink:#ffb6d5;
      --pink2:#ffd3e6;
      --blue:#bfe8ff;
      --mint:#c8f7e7;
      --lav:#e7ddff;
      --good:#16a34a;
      --bad:#ef4444;
      --shadow: 0 18px 40px rgba(15,23,42,.10);
      --radius: 22px;
      --tap: 48px;
      --max-width: 980px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      /* Respect device safe area (notch / status bar) */
      padding-top: env(safe-area-inset-top, 0px);
      font-family: Nunito, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 15% 10%, var(--pink2), transparent 55%),
        radial-gradient(900px 600px at 85% 20%, var(--blue), transparent 55%),
        radial-gradient(900px 600px at 50% 95%, var(--mint), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    .app{
      min-height:100%;
      display:flex;
      align-items:flex-end; /* mobile thumb reach */
      justify-content:center;
      /* add safe-area top inset to avoid notch/overlay blocking the header/timer */
      padding: calc(18px + env(safe-area-inset-top, 0px)) 14px 22px;
    }

    .shell{
      width:min(var(--max-width), 100%);
      display:grid;
      grid-template-rows: auto auto 1fr;
      gap:12px;
    }

    /* Top decorative banner */
    .top-banner{
      position:relative;
      width:100%;
      height:84px;
      border-radius: 22px;
      background:
        linear-gradient(90deg, rgba(255,182,213,.95), rgba(191,232,255,.95), rgba(200,247,231,.95));
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:16px 16px;
      border:1px solid rgba(255,255,255,.65);
    }
    .top-banner::before,
    .top-banner::after{
      content:"";
      position:absolute;
      inset:auto;
      width:180px;
      height:180px;
      border-radius:999px;
      filter: blur(0px);
      opacity:.25;
    }
    .top-banner::before{ left:-40px; top:-80px; background: var(--lav); }
    .top-banner::after{ right:-60px; bottom:-90px; background: #fff; }

    .brand{
      position:relative;
      display:flex;
      gap:10px;
      align-items:center;
      z-index:1;
    }
    .brand-badge{
      width:44px;
      height:44px;
      border-radius:16px;
      background: rgba(255,255,255,.75);
      display:grid;
      place-items:center;
      border:1px solid rgba(255,255,255,.7);
      box-shadow: 0 12px 18px rgba(15,23,42,.08);
    }
    .brand-badge svg{ width:30px; height:30px; }

    .title-wrap{
      display:flex;
      flex-direction:column;
      line-height:1.05;
    }
    .title{
      font-family: "Baloo 2", system-ui, sans-serif;
      font-weight:700;
      font-size: 22px;
      letter-spacing: .2px;
      margin:0;
    }
    .subtitle{
      margin:0;
      font-size: 12.8px;
      color: rgba(31,41,55,.72);
      font-weight: 700;
    }

    .mode-pill{
      position:relative;
      z-index:1;
      display:flex;
      gap:8px;
      align-items:center;
      padding:8px;
      background: rgba(255,255,255,.60);
      border:1px solid rgba(255,255,255,.65);
      border-radius: 999px;
    }
    .seg{
      display:flex;
      gap:6px;
      align-items:center;
    }

    .chip{
      border:0;
      background: transparent;
      padding: 10px 12px;
      border-radius: 999px;
      font-weight: 800;
      color: rgba(31,41,55,.78);
      cursor:pointer;
      min-height: var(--tap);
      display:flex;
      align-items:center;
      gap:8px;
    }
    .chip[aria-pressed="true"]{
      background: rgba(255,255,255,.92);
      box-shadow: 0 10px 18px rgba(15,23,42,.10);
      color: var(--ink);
    }
    .chip svg{ width:18px; height:18px; opacity:.9; }

    /* Onesie card */
    .onesie{
      position:relative;
      background: rgba(255,255,255,.82);
      border:1px solid rgba(255,255,255,.75);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    .onesie-inner{
      position:relative;
      padding: 16px;
    }

    /* Onesie silhouette accents */
    .onesie::before{
      content:"";
      position:absolute;
      left:50%;
      top:-26px;
      transform:translateX(-50%);
      width: 160px;
      height: 68px;
      border-radius: 0 0 38px 38px;
      background: rgba(255,255,255,.88);
      border:1px solid rgba(229,231,235,.9);
      box-shadow: 0 12px 20px rgba(15,23,42,.06);
    }
    .onesie::after{
      content:"";
      position:absolute;
      left:0; right:0; bottom:-1px;
      height: 46px;
      background:
        radial-gradient(24px 24px at 30% 22%, rgba(255,182,213,.55) 45%, transparent 47%),
        radial-gradient(24px 24px at 50% 22%, rgba(191,232,255,.55) 45%, transparent 47%),
        radial-gradient(24px 24px at 70% 22%, rgba(200,247,231,.55) 45%, transparent 47%),
        linear-gradient(0deg, rgba(231,221,255,.30), transparent 78%);
      border-top: 1px solid rgba(229,231,235,.9);
    }

    .onesie-tabs{
      display:flex;
      gap:10px;
      align-items:center;
      justify-content:space-between;
      flex-wrap:wrap;
      padding: 14px 16px 0;
    }

    .round-meta{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    .pill{
      display:flex;
      gap:10px;
      align-items:center;
      padding:10px 12px;
      background: rgba(255,255,255,.9);
      border:1px solid rgba(229,231,235,.95);
      border-radius: 999px;
      box-shadow: 0 10px 16px rgba(15,23,42,.05);
    }
    .pill label{
      font-weight: 900;
      font-size: 12.5px;
      color: rgba(31,41,55,.78);
    }

    select{
      appearance:none;
      border: 0;
      background: transparent;
      font-weight: 900;
      color: var(--ink);
      cursor:pointer;
      padding-right: 18px;
      font-size: 13.5px;
      outline:none;
    }

    .select-wrap{ position:relative; }
    .select-wrap::after{
      content:"▾";
      position:absolute;
      right:0;
      top:50%;
      transform:translateY(-50%);
      font-weight: 900;
      color: rgba(31,41,55,.70);
      pointer-events:none;
    }

    .score{
      font-weight: 900;
      font-size: 13px;
      color: rgba(31,41,55,.75);
    }

    .timer{
      font-weight: 900;
      font-size: 13px;
      color: rgba(31,41,55,.75);
    }

    .btnrow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }

    .btn{
      border:1px solid rgba(229,231,235,.95);
      background: rgba(255,255,255,.92);
      color: var(--ink);
      font-weight: 900;
      border-radius: 14px;
      padding: 10px 12px;
      cursor:pointer;
      min-height: var(--tap);
      display:inline-flex;
      align-items:center;
      gap:8px;
      box-shadow: 0 10px 16px rgba(15,23,42,.05);
      transition: transform .12s ease, box-shadow .12s ease;
    }
    .btn:active{ transform: translateY(1px) scale(.99); box-shadow: 0 6px 10px rgba(15,23,42,.06); }
    .btn.primary{
      background: linear-gradient(90deg, rgba(255,182,213,.85), rgba(191,232,255,.85));
      border-color: rgba(255,255,255,.7);
    }
    .btn.danger{
      background: rgba(239,68,68,.08);
      border-color: rgba(239,68,68,.25);
    }
    .btn svg{ width:18px; height:18px; }

    .content{
      padding: 10px 16px 18px;
    }

    .hint{
      margin: 0 0 10px;
      color: var(--muted);
      font-weight: 700;
      font-size: 13.5px;
    }

    .grid{
      display:grid;
      gap:10px;
    }

    .row{
      display:grid;
      gap:10px;
      grid-template-columns: 1fr;
      padding: 12px;
      border-radius: 16px;
      border: 1px solid rgba(229,231,235,.95);
      background: rgba(255,255,255,.9);
      align-items:center;
    }

    .scramble{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .scramble code{
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      font-weight: 900;
      font-size: 14px;
      background: rgba(231,221,255,.35);
      border: 1px dashed rgba(107,114,128,.28);
      padding: 8px 10px;
      border-radius: 12px;
    }

    .answer{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
    }

    input[type="text"]{
      flex: 1 1 220px;
      min-height: var(--tap);
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(229,231,235,.95);
      outline: none;
      font-size: 15px;
      font-weight: 700;
      background: #fff;
    }
    input[type="text"]:focus{
      box-shadow: 0 0 0 4px rgba(191,232,255,.45);
      border-color: rgba(191,232,255,.8);
    }
    input[disabled]{
      opacity: .7;
      background: rgba(249,250,251,.9);
    }

    .status{
      width: 42px;
      height: 42px;
      border-radius: 14px;
      display:grid;
      place-items:center;
      border: 1px solid rgba(229,231,235,.95);
      background: rgba(249,250,251,.92);
      flex: 0 0 auto;
    }
    .status.good{
      border-color: rgba(22,163,74,.30);
      background: rgba(22,163,74,.08);
      color: var(--good);
    }
    .status.bad{
      border-color: rgba(239,68,68,.30);
      background: rgba(239,68,68,.07);
      color: var(--bad);
    }

    .status svg{ width:22px; height:22px; }

    .mini{
      font-size: 12.5px;
      color: var(--muted);
      font-weight: 800;
    }

    .shake{ animation: shake .38s ease; }
    @keyframes shake{
      0%{ transform: translateX(0); }
      20%{ transform: translateX(-7px); }
      40%{ transform: translateX(7px); }
      60%{ transform: translateX(-6px); }
      80%{ transform: translateX(6px); }
      100%{ transform: translateX(0); }
    }

    /* Subtle highlight when marking correct */
    .pulse{ animation: pulse .5s ease; }
    @keyframes pulse{
      0%{ box-shadow: 0 0 0 0 rgba(22,163,74,.18); }
      100%{ box-shadow: 0 0 0 14px rgba(22,163,74,0); }
    }

    .host-panel{
      margin-top: 12px;
      padding: 12px;
      border-radius: 18px;
      border: 1px solid rgba(229,231,235,.95);
      background: rgba(231,221,255,.18);
    }

    .host-actions{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }

    .answers{
      margin-top: 10px;
      display:none;
      gap:10px;
    }
    .answers.show{ display:grid; }

    .answer-card{
      border:1px solid rgba(229,231,235,.95);
      border-radius: 18px;
      background: rgba(255,255,255,.92);
      padding: 12px;
    }
    .answer-card h3{
      margin:0 0 6px;
      font-family:"Baloo 2", system-ui, sans-serif;
      font-size: 17px;
    }
    .answer-list{
      margin:0;
      padding-left: 18px;
      color: rgba(31,41,55,.85);
      font-weight: 700;
      font-size: 13.5px;
    }
    .answer-list li{ margin: 4px 0; }

    .footer{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
      padding: 0 4px;
      color: rgba(31,41,55,.62);
      font-weight: 800;
      font-size: 12.5px;
    }

    /* Desktop layout upgrades */
    @media (min-width: 780px){
      .app{ align-items:center; padding:24px 18px 30px; }
      .top-banner{ height: 92px; }
      .row{
        grid-template-columns: 1fr 1.6fr;
        align-items:center;
      }
      .scramble{ justify-content:flex-start; }
      .content{ padding: 10px 18px 22px; }
      .onesie-inner{ padding: 18px; }
    }

    /* Reduce motion respect */
    @media (prefers-reduced-motion: reduce){
      .shake,.pulse{ animation:none !important; }
      .btn{ transition:none; }
    }
  </style>
</head>
<body>
  <main class="app" role="main">
    <div class="shell">

      <header class="top-banner" aria-label="Baby Word Scramble header">
        <div class="brand">
          <div class="brand-badge" aria-hidden="true">
            <!-- baby onesie icon -->
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M8 3.5c0 1.38 1.12 2.5 2.5 2.5h3C14.88 6 16 4.88 16 3.5" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round"/>
              <path d="M7 6.2 5.2 8c-.75.75-.75 1.97 0 2.72L7 12.5V19c0 1.66 1.34 3 3 3h4c1.66 0 3-1.34 3-3v-6.5l1.8-1.78c.75-.75.75-1.97 0-2.72L17 6.2" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round"/>
              <path d="M9.2 20.8c.4-1.2 1.5-2 2.8-2s2.4.8 2.8 2" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round"/>
              <path d="M10 14.5h4" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="title-wrap">
            <h1 class="title">Baby Word Scramble</h1>
            <p class="subtitle">Fixed rounds • One link • Player + Host modes</p>
          </div>
        </div>

        <div class="mode-pill" aria-label="Mode switch">
          <button id="playerBtn" class="chip" type="button" aria-pressed="true" title="Player mode">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 12a4.5 4.5 0 1 0 0-9 4.5 4.5 0 0 0 0 9Zm8 9a8 8 0 1 0-16 0" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round"/></svg>
            Player
          </button>
          <button id="hostBtn" class="chip" type="button" aria-pressed="false" title="Host mode">
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 12 7 22h10l-2-10" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round" stroke-linejoin="round"/></svg>
            Host
          </button>
        </div>
      </header>

      <section class="onesie" aria-label="Game card">
        <div class="onesie-tabs">
          <div class="round-meta">
            <div class="pill" aria-label="Round selector">
              <label for="roundSelect">Round</label>
              <span class="select-wrap">
                <select id="roundSelect" aria-label="Choose round"></select>
              </span>
            </div>

            <div class="pill" aria-label="Round score">
              <span class="score" id="scoreText">0 / 0 correct</span>
            </div>

            <div class="pill" aria-label="Total score">
              <span class="score" id="totalScoreText">Total: 0 / 0</span>
            </div>

            <div class="pill" aria-label="Timer">
              <span class="timer" id="timerText">⏱ 00:00</span>
              <button class="btn" id="timerToggle" type="button" aria-label="Toggle timer" style="min-height:40px;padding:8px 10px;border-radius:999px;">
                <span id="timerToggleText">Start</span>
              </button>
            </div>
          </div>

          <div class="btnrow">
            <button class="btn" id="prevRound" type="button" title="Previous round">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M15 18 9 12l6-6" stroke="#1F2937" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
              Previous
            </button>
            <button class="btn primary" id="nextRound" type="button" title="Next round">
              Next
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M9 6l6 6-6 6" stroke="#1F2937" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round"/></svg>
            </button>
            <button class="btn danger" id="resetBtn" type="button" title="Reset my progress">
              <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M21 12a9 9 0 1 1-3.2-6.9" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round"/></svg>
              Reset
            </button>
          </div>
        </div>

        <div class="onesie-inner">
          <div class="content">
            <p class="hint" id="modeHint">Type your guess and press <b>Enter</b> or tap <b>Check</b>. Correct answers lock in and increase your score.</p>
            <div id="rows" class="grid" aria-live="polite"></div>

            <div id="hostPanel" class="host-panel" hidden>
              <div class="host-actions">
                <div class="pill" style="gap:8px;">
                  <label for="hostPin">Host PIN</label>
                  <input id="hostPin" type="text" inputmode="numeric" pattern="[0-9]*" placeholder="Enter PIN" aria-label="Host PIN" style="max-width:160px;min-height:40px;border-radius:999px;" />
                  <button class="btn primary" id="hostUnlock" type="button">Unlock</button>
                </div>

                <button class="btn" id="jumpRoundBtn" type="button" disabled>Jump to…</button>
                <button class="btn" id="showAllAnswersBtn" type="button" disabled>Show All Answers</button>
                <button class="btn danger" id="hostLogout" type="button" hidden>Host Logout</button>
                <span class="mini" id="hostStatus">Locked</span>
              </div>

              <div id="answers" class="answers" aria-label="Answer key"></div>
            </div>

            <div class="footer">
              <span>Tip: Host can tell everyone “Go to Round X” using the selector.</span>
              <span>Progress saves on this device.</span>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <script>
    // =========================
    // CONFIG
    // =========================
    const HOST_PIN = "1979"; // ← change me (Host/Admin PIN)
    const STORAGE_KEY = "baby_word_scramble_v1";

    // =========================
    // DATA (12 rounds × 12 entries)
    // =========================
    // NOTE: We keep plaintext answers here to allow Host mode answer key.
    // Player mode never inserts these answers into the DOM.
    // Validation uses SHA-256 hashes.
    const ROUNDS = [
      {
        title: "Round 1",
        items: [
          { answer: "bottle", scramble: "OLTBTE" },
          { answer: "pacifier", scramble: "RAEICFIP" },
          { answer: "stroller", scramble: "RLETSORL" },
          { answer: "diapers", scramble: "SRPAEID" },
          { answer: "bib", scramble: "BBI" },
          { answer: "onesie", scramble: "EINOSE" },
          { answer: "baby shower", scramble: "YBAB WOSHER" },
          { answer: "rattle", scramble: "TLRTAE" },
          { answer: "teether", scramble: "REHTTEE" },
          { answer: "crib", scramble: "BIRC" },
          { answer: "swaddle", scramble: "DADSWEL" },
          { answer: "bassinet", scramble: "SENIABTS" },
        ]
      },
      {
        title: "Round 2",
        items: [
          { answer: "baby powder", scramble: "YBAB WOPDER" },
          { answer: "burp cloth", scramble: "BRPU HTLOC" },
          { answer: "nursery", scramble: "SURNREY" },
          { answer: "blanket", scramble: "KETLBAN" },
          { answer: "high chair", scramble: "GIHH RAHIC" },
          { answer: "binky", scramble: "NIBKY" },
          { answer: "booties", scramble: "EISBTOO" },
          { answer: "mittens", scramble: "TNEITSM" },
          { answer: "baby lotion", scramble: "YBAB NTOILO" },
          { answer: "changing pad", scramble: "GNIHCNA DAP" },
          { answer: "baby wipe", scramble: "YBAB PEWI" },
          { answer: "teddy bear", scramble: "DYTED EABR" },
        ]
      },
      {
        title: "Round 3",
        items: [
          { answer: "bottle warmer", scramble: "OTTLBE RMWRAE" },
          { answer: "baby monitor", scramble: "YBAB TINOMRO" },
          { answer: "rocking chair", scramble: "KCORIGN RAHIC" },
          { answer: "story book", scramble: "YRSTO OKBO" },
          { answer: "baby socks", scramble: "YBAB SKSOC" },
          { answer: "newborn", scramble: "WENOBRN" },
          { answer: "baby carrier", scramble: "YBAB RIRACRE" },
          { answer: "play mat", scramble: "YALP TAM" },
          { answer: "baby bath", scramble: "YBAB HTBA" },
          { answer: "breast pump", scramble: "TSABER PMUP" },
          { answer: "diaper bag", scramble: "RPAEDI GAB" },
          { answer: "nursing pillow", scramble: "SNIRUGN WOLIPL" },
        ]
      },
      {
        title: "Round 4",
        items: [
          { answer: "baby blanket", scramble: "YBAB KETLBAN" },
          { answer: "crib sheet", scramble: "BIRC TEESH" },
          { answer: "baby formula", scramble: "YBAB LMFRUAO" },
          { answer: "pacifier clip", scramble: "RAEICFIP PLIC" },
          { answer: "baby food", scramble: "YBAB ODFO" },
          { answer: "sippy cup", scramble: "YIPPS PCUP" },
          { answer: "bath toy", scramble: "HTBA YTO" },
          { answer: "diaper cream", scramble: "RPAEDI MRECAE" },
          { answer: "baby book", scramble: "YBAB KOBO" },
          { answer: "baby shower game", scramble: "YBAB WOSHER EMAG" },
          { answer: "cute outfit", scramble: "ETUC TUFIFO" },
          { answer: "sleep sack", scramble: "EESLP KCAKS" },
        ]
      },
      {
        title: "Round 5",
        items: [
          { answer: "baby name", scramble: "YBAB EMAN" },
          { answer: "pregnancy", scramble: "GNANCRYPE" },
          { answer: "ultrasound", scramble: "ASLUOTDNRU" },
          { answer: "tiny toes", scramble: "YINT OSET" },
          { answer: "first smile", scramble: "TSRIF LIMES" },
          { answer: "baby giggle", scramble: "YBAB GLGIGE" },
          { answer: "lullaby", scramble: "ALULBYL" },
          { answer: "twin stroller", scramble: "WINT RLETSORL" },
          { answer: "baby shower gifts", scramble: "YBAB WOSHER TSGIF" },
          { answer: "little one", scramble: "LTILE ENO" },
          { answer: "soft blanket", scramble: "TOSF KETLBAN" },
          { answer: "snuggle", scramble: "GLESGUN" },
        ]
      },
      {
        title: "Round 6",
        items: [
          { answer: "diaper rash", scramble: "RPAEDI HSRA" },
          { answer: "baby shampoo", scramble: "YBAB HSPMAOO" },
          { answer: "baby towel", scramble: "YBAB WELTO" },
          { answer: "hooded towel", scramble: "DOHDOE WELTO" },
          { answer: "washcloth", scramble: "HSLTAWCO" },
          { answer: "baby brush", scramble: "YBAB HRSUB" },
          { answer: "nail clippers", scramble: "LIAN PREPCLSI" },
          { answer: "thermometer", scramble: "RTEHMROMETE" },
          { answer: "baby oil", scramble: "YBAB LIO" },
          { answer: "gentle soap", scramble: "GTELNE PAOS" },
          { answer: "laundry", scramble: "NDYUARL" },
          { answer: "baby swing", scramble: "YBAB GNISW" },
        ]
      },
      {
        title: "Round 7",
        items: [
          { answer: "crib mobile", scramble: "BIRC BLEOMI" },
          { answer: "night light", scramble: "HITNG TGHLI" },
          { answer: "white noise", scramble: "EHWIT SIONE" },
          { answer: "baby mobile", scramble: "YBAB BLEOMI" },
          { answer: "baby pajamas", scramble: "YBAB SJAMYAP" },
          { answer: "sleepy baby", scramble: "EESLYP YBAB" },
          { answer: "nap time", scramble: "PAN EMIT" },
          { answer: "rock a bye", scramble: "KCOR A YEB" },
          { answer: "storybook", scramble: "YBOKRTSO" },
          { answer: "nursery rhyme", scramble: "SURNREY EHMRY" },
          { answer: "baby giggles", scramble: "YBAB SELGIGG" },
          { answer: "cuddle", scramble: "LDEUCD" },
        ]
      },
      {
        title: "Round 8",
        items: [
          { answer: "baby registry", scramble: "YBAB RIGTSYRE" },
          { answer: "baby shower invite", scramble: "YBAB WOSHER TEIINV" },
          { answer: "gift wrap", scramble: "TFGI PARW" },
          { answer: "thank you", scramble: "KHTNA UOY" },
          { answer: "party favors", scramble: "YRATP SROVFA" },
          { answer: "balloons", scramble: "SOOLNAB" },
          { answer: "decorations", scramble: "NOCORATSEDI" },
          { answer: "cupcake", scramble: "KACPCUE" },
          { answer: "cookies", scramble: "IESOKCO" },
          { answer: "baby shower cake", scramble: "YBAB WOSHER EKCA" },
          { answer: "photo booth", scramble: "TOHOP HTOOB" },
          { answer: "guess the baby", scramble: "SSEUG EHT YBAB" },
        ]
      },
      {
        title: "Round 9",
        items: [
          { answer: "baby shoes", scramble: "YBAB SOHES" },
          { answer: "baby hat", scramble: "YBAB ATH" },
          { answer: "baby mitts", scramble: "YBAB STTIM" },
          { answer: "baby blanket", scramble: "YBAB KETLBAN" },
          { answer: "baby bib", scramble: "YBAB BBI" },
          { answer: "baby wipes", scramble: "YBAB SEPIW" },
          { answer: "diaper pins", scramble: "RPAEDI SNIP" },
          { answer: "burp time", scramble: "BRPU EMIT" },
          { answer: "baby bottle", scramble: "YBAB OTLTBE" },
          { answer: "baby rattle", scramble: "YBAB TLRTAE" },
          { answer: "pacifier", scramble: "RAEICFIP" },
          { answer: "stroller", scramble: "RLETSORL" },
        ]
      },
      {
        title: "Round 10",
        items: [
          { answer: "baby laugh", scramble: "YBAB HGUAF" },
          { answer: "tiny hands", scramble: "YINT SDNAH" },
          { answer: "sweet dreams", scramble: "EETWS SREAMD" },
          { answer: "little star", scramble: "LTILE RATS" },
          { answer: "peek a boo", scramble: "KEPE A OBO" },
          { answer: "first steps", scramble: "TSRIF PSTES" },
          { answer: "bath time", scramble: "HTBA EMIT" },
          { answer: "snack time", scramble: "KCSAN EMIT" },
          { answer: "tummy time", scramble: "MYTUM EMIT" },
          { answer: "baby giggle", scramble: "YBAB GLGIGE" },
          { answer: "big hugs", scramble: "GIB SUGH" },
          { answer: "baby kisses", scramble: "YBAB SSEKIS" },
        ]
      },
      {
        title: "Round 11",
        items: [
          { answer: "baby carrier", scramble: "YBAB RIRACRE" },
          { answer: "car seat", scramble: "RAC TAES" },
          { answer: "stroller", scramble: "RLETSORL" },
          { answer: "baby gate", scramble: "YBAB TEAG" },
          { answer: "play pen", scramble: "YALP NEP" },
          { answer: "teething ring", scramble: "GNIEHTET GNIR" },
          { answer: "bath thermometer", scramble: "HTBA RTEHMROMETE" },
          { answer: "diaper genie", scramble: "RPAEDI EINNEG" },
          { answer: "baby swing", scramble: "YBAB GNISW" },
          { answer: "rocking horse", scramble: "KCORIGN ESROH" },
          { answer: "soft toy", scramble: "TOSF YTO" },
          { answer: "baby book", scramble: "YBAB KOBO" },
        ]
      },
      {
        title: "Round 12",
        items: [
          { answer: "baby shower", scramble: "YBAB WOSHER" },
          { answer: "new parents", scramble: "WEN SRETNAP" },
          { answer: "congratulations", scramble: "SNOITUTLARGACON" },
          { answer: "bundle of joy", scramble: "LEDNUB FO JOY" },
          { answer: "little miracle", scramble: "LTILE ELRACIM" },
          { answer: "welcome baby", scramble: "EMOCLEW YBAB" },
          { answer: "tiny fingers", scramble: "YINT SREGNIF" },
          { answer: "tiny toes", scramble: "YINT OSET" },
          { answer: "sweet baby", scramble: "EETWS YBAB" },
          { answer: "baby love", scramble: "YBAB EVOL" },
          { answer: "baby shower fun", scramble: "YBAB WOSHER NUF" },
          { answer: "little blessing", scramble: "LTILE GNSSIBLE" },
        ]
      }
    ];

    // =========================
    // UTIL: normalize + hash (SHA-256)
    // =========================
    function normalizeAnswer(str){
      return (str || "")
        .toLowerCase()
        .trim()
        .replace(/\s+/g, " ")
        .replace(/[^a-z0-9 ]/g, "");
    }

    async function sha256Hex(str){
      const enc = new TextEncoder();
      const buf = enc.encode(str);
      const digest = await crypto.subtle.digest("SHA-256", buf);
      const bytes = new Uint8Array(digest);
      return [...bytes].map(b => b.toString(16).padStart(2, "0")).join("");
    }

    // Precompute answer hashes for player validation.
    // We keep plaintext answers in memory for Host mode, but Player mode uses hashes.
    let ROUND_HASHES = []; // [{ hashes: [..] }]

    // =========================
    // STATE + STORAGE
    // =========================
    const defaultState = () => ({
      currentRound: 0,
      mode: "player", // 'player' | 'host'
      hostUnlocked: false,
      progress: {
        // roundIndex: { items: { itemIndex: { input: string, correct: boolean } }, timer: {running:boolean, elapsedMs:number, lastTick: number|null } }
      }
    });

    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const parsed = JSON.parse(raw);
        if(typeof parsed !== "object" || parsed === null) return defaultState();
        return {
          ...defaultState(),
          ...parsed,
          hostUnlocked: false, // always relock on refresh for safety
          mode: "player"       // default back to player on refresh
        };
      }catch{
        return defaultState();
      }
    }

    function saveState(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(state));
    }

    let state = loadState();

    // =========================
    // TIMER
    // =========================
    let timerInterval = null;

    function getRoundProgress(roundIndex){
      if(!state.progress[roundIndex]){
        state.progress[roundIndex] = {
          items: {},
          timer: { running:false, elapsedMs:0, lastTick: null }
        };
      }
      return state.progress[roundIndex];
    }

    function formatTime(ms){
      const total = Math.max(0, Math.floor(ms/1000));
      const m = String(Math.floor(total/60)).padStart(2,"0");
      const s = String(total%60).padStart(2,"0");
      return `${m}:${s}`;
    }

    function syncTimerUI(){
      const prog = getRoundProgress(state.currentRound);
      document.getElementById("timerText").textContent = `⏱ ${formatTime(prog.timer.elapsedMs)}`;
      document.getElementById("timerToggleText").textContent = prog.timer.running ? "Pause" : "Start";
    }

    function stopTimerInterval(){
      if(timerInterval) clearInterval(timerInterval);
      timerInterval = null;
    }

    function startTimerInterval(){
      stopTimerInterval();
      timerInterval = setInterval(() => {
        const prog = getRoundProgress(state.currentRound);
        if(!prog.timer.running) return;
        const now = Date.now();
        if(prog.timer.lastTick == null) prog.timer.lastTick = now;
        const dt = now - prog.timer.lastTick;
        prog.timer.lastTick = now;
        prog.timer.elapsedMs += dt;
        syncTimerUI();
        saveState();
      }, 250);
    }

    function toggleTimer(){
      const prog = getRoundProgress(state.currentRound);
      prog.timer.running = !prog.timer.running;
      prog.timer.lastTick = prog.timer.running ? Date.now() : null;
      syncTimerUI();
      saveState();
      if(prog.timer.running) startTimerInterval();
      else stopTimerInterval();
    }

    function resetTimerForRound(roundIndex){
      const prog = getRoundProgress(roundIndex);
      prog.timer = { running:false, elapsedMs:0, lastTick: null };
      saveState();
      if(roundIndex === state.currentRound) syncTimerUI();
      if(roundIndex === state.currentRound) stopTimerInterval();
    }

    // =========================
    // UI ELEMENTS
    // =========================
    const rowsEl = document.getElementById("rows");
    const roundSelectEl = document.getElementById("roundSelect");
    const scoreTextEl = document.getElementById("scoreText");
    const totalScoreTextEl = document.getElementById("totalScoreText");
    const playerBtn = document.getElementById("playerBtn");
    const hostBtn = document.getElementById("hostBtn");
    const modeHintEl = document.getElementById("modeHint");
    const hostPanelEl = document.getElementById("hostPanel");
    const hostPinEl = document.getElementById("hostPin");
    const hostUnlockEl = document.getElementById("hostUnlock");
    const hostStatusEl = document.getElementById("hostStatus");
    const answersEl = document.getElementById("answers");
    const jumpRoundBtn = document.getElementById("jumpRoundBtn");
    const showAllAnswersBtn = document.getElementById("showAllAnswersBtn");
    const hostLogoutBtn = document.getElementById("hostLogout");

    // Buttons - wire after declarations
    document.getElementById("prevRound").addEventListener("click", () => setRound(state.currentRound - 1));
    document.getElementById("nextRound").addEventListener("click", () => setRound(state.currentRound + 1));
    document.getElementById("resetBtn").addEventListener("click", resetProgress);
    document.getElementById("timerToggle").addEventListener("click", toggleTimer);

    // Mode toggles
    playerBtn.addEventListener("click", () => setMode("player"));
    hostBtn.addEventListener("click", () => setMode("host"));

    // Round selector
    roundSelectEl.addEventListener("change", (e) => setRound(parseInt(e.target.value, 10)));

    // Host unlock
    hostUnlockEl.addEventListener("click", unlockHost);
    hostPinEl.addEventListener("keydown", (e) => {
      if(e.key === "Enter") unlockHost();
    });

    // Host logout
    hostLogoutBtn.addEventListener("click", () => {
      state.hostUnlocked = false;
      hostPinEl.value = "";
      hostStatusEl.textContent = "Locked";
      jumpRoundBtn.disabled = true;
      showAllAnswersBtn.disabled = true;
      hostLogoutBtn.hidden = true;
      answersEl.classList.remove("show");
      answersEl.innerHTML = "";
      saveState();
      renderRound();
      updateHostPanelVisibility();
    });

    // Jump to round (host only)
    jumpRoundBtn.addEventListener("click", () => {
      if(!state.hostUnlocked) return;
      const input = prompt(`Jump to round (1-${ROUNDS.length}):`);
      if (!input) return;
      const n = parseInt(input, 10);
      if (Number.isFinite(n) && n >= 1 && n <= ROUNDS.length) {
        setRound(n - 1);
      }
    });

    // Show/hide answers
    showAllAnswersBtn.addEventListener('click', () => {
      if (!state.hostUnlocked) return;
      const showing = answersEl.classList.toggle('show');
      showAllAnswersBtn.textContent = showing ? 'Hide Answers' : 'Show All Answers';
    });

    // =========================
    // RENDER / GAME LOGIC
    // =========================

    // compute hashes
    async function computeRoundHashes(){
      const all = [];
      for (let r = 0; r < ROUNDS.length; r++){
        const round = ROUNDS[r];
        const hashes = [];
        for (let i = 0; i < round.items.length; i++){
          const norm = normalizeAnswer(round.items[i].answer);
          const h = await sha256Hex(norm);
          hashes.push(h);
        }
        all.push({ hashes });
      }
      ROUND_HASHES = all;
    }

    function ensureProgressForRound(roundIndex){
      getRoundProgress(roundIndex); // creates if missing
      saveState();
    }

    function setRound(index){
      if (index < 0) index = 0;
      if (index >= ROUNDS.length) index = ROUNDS.length - 1;
      state.currentRound = index;
      // stop timer for previous intervals start/stop handled via timer functions
      saveState();
      renderRound();
      renderRoundSelector();
      syncTimerUI();
      updateHostPanelVisibility();
    }

    function setMode(mode){
      state.mode = mode === 'host' ? 'host' : 'player';
      // update pressed states
      playerBtn.setAttribute('aria-pressed', state.mode === 'player' ? 'true' : 'false');
      hostBtn.setAttribute('aria-pressed', state.mode === 'host' ? 'true' : 'false');
      // show/hide host panel
      updateHostPanelVisibility();
      saveState();
      renderRound();
    }

    function resetProgress(){
      if (!confirm("Reset all saved progress for this device?")) return;
      state = defaultState();
      saveState();
      renderRound();
      renderRoundSelector();
      updateScores();
      updateHostPanelVisibility();
      syncTimerUI();
    }

    function updateScores(){
      // round score
      const prog = getRoundProgress(state.currentRound);
      const items = ROUNDS[state.currentRound].items.length;
      let correctThisRound = 0;
      if (prog && prog.items){
        for (const k of Object.keys(prog.items)){
          if (prog.items[k] && prog.items[k].correct) correctThisRound++;
        }
      }
      scoreTextEl.textContent = `${correctThisRound} / ${items} correct`;

      // total score across rounds
      let totalCorrect = 0;
      let totalItems = 0;
      for (let r = 0; r < ROUNDS.length; r++){
        totalItems += ROUNDS[r].items.length;
        const rp = state.progress[r];
        if (rp && rp.items){
          for (const k of Object.keys(rp.items)){
            if (rp.items[k] && rp.items[k].correct) totalCorrect++;
          }
        }
      }
      totalScoreTextEl.textContent = `Total: ${totalCorrect} / ${totalItems}`;
    }

    function renderRoundSelector(){
      // populate select options if empty or mismatched
      if (roundSelectEl.children.length !== ROUNDS.length){
        roundSelectEl.innerHTML = '';
        for (let i = 0; i < ROUNDS.length; i++){
          const opt = document.createElement('option');
          opt.value = String(i);
          opt.textContent = ROUNDS[i].title || `Round ${i+1}`;
          roundSelectEl.appendChild(opt);
        }
      }
      roundSelectEl.value = String(state.currentRound);
    }

    function createStatusIcon(type){
      const wrap = document.createElement('div');
      wrap.className = 'status';
      if (type === 'good') wrap.classList.add('good');
      else if (type === 'bad') wrap.classList.add('bad');
      return wrap;
    }

    function renderRow(rIndex, iIndex, item, progItem){
      const row = document.createElement('div');
      row.className = 'row';
      // left column: scramble + input
      const left = document.createElement('div');
      left.style.display = 'flex';
      left.style.flexDirection = 'column';
      left.style.gap = '8px';

      const scrambleWrap = document.createElement('div');
      scrambleWrap.className = 'scramble';
      const code = document.createElement('code');
      code.textContent = item.scramble;
      scrambleWrap.appendChild(code);

      // input area
      const answerWrap = document.createElement('div');
      answerWrap.className = 'answer';
      answerWrap.style.width = '100%';

      const input = document.createElement('input');
      input.type = 'text';
      input.autocomplete = 'off';
      input.spellcheck = false;
      input.placeholder = 'Type your guess';
      input.value = (progItem && progItem.input) ? progItem.input : '';
      input.dataset.itemIndex = String(iIndex);
      input.style.flex = '1 1 auto';
      input.style.minWidth = '120px';

      // disable input if correct
      if (progItem && progItem.correct){
        input.disabled = true;
      }

      // Check button
      const checkBtn = document.createElement('button');
      checkBtn.className = 'btn';
      checkBtn.type = 'button';
      checkBtn.textContent = 'Check';
      checkBtn.style.minHeight = '36px';
      checkBtn.dataset.itemIndex = String(iIndex);
      if (progItem && progItem.correct){
        checkBtn.disabled = true;
      }

      answerWrap.appendChild(input);
      answerWrap.appendChild(checkBtn);

      left.appendChild(scrambleWrap);
      left.appendChild(answerWrap);

      // right column: status / host answer
      const right = document.createElement('div');
      right.style.display = 'flex';
      right.style.gap = '8px';
      right.style.alignItems = 'center';
      right.style.justifyContent = 'flex-end';

      const status = createStatusIcon();
      // if already correct, show good icon
      if (progItem && progItem.correct){
        status.classList.add('good');
        status.innerHTML = '✓';
      }

      // If host unlocked and mode is host, show plaintext answer
      const hostAnswer = document.createElement('div');
      hostAnswer.className = 'mini';
      if (state.mode === 'host' && state.hostUnlocked){
        hostAnswer.textContent = item.answer;
      } else {
        hostAnswer.textContent = '';
      }

      right.appendChild(hostAnswer);
      right.appendChild(status);

      // layout: on wider screens we want two columns (left/right)
      // But we will append left and right directly into row and rely on CSS grid to rearrange.
      row.appendChild(left);
      row.appendChild(right);

      // Event listeners
      input.addEventListener('keydown', (ev) => {
        if (ev.key === 'Enter'){
          ev.preventDefault();
          checkAnswer(rIndex, iIndex, input, status, checkBtn, hostAnswer);
        }
      });

      checkBtn.addEventListener('click', () => {
        checkAnswer(rIndex, iIndex, input, status, checkBtn, hostAnswer);
      });

      // Auto-start timer: when typing input (only in player mode)
      input.addEventListener('input', () => {
        if (state.mode === 'player'){
          const prog = getRoundProgress(state.currentRound);
          if (!prog.timer.running){
            prog.timer.running = true;
            prog.timer.lastTick = Date.now();
            saveState();
            startTimerInterval();
            syncTimerUI();
          }
        }
      });

      return row;
    }

    async function checkAnswer(roundIndex, itemIndex, inputEl, statusEl, checkBtnEl, hostAnswerEl){
      const val = inputEl.value || '';
      const norm = normalizeAnswer(val);
      const hash = await sha256Hex(norm);
      const expectedHash = ROUND_HASHES[roundIndex].hashes[itemIndex];

      // ensure progress structure
      const rp = getRoundProgress(roundIndex);
      if (!rp.items[itemIndex]) rp.items[itemIndex] = { input: '', correct: false };

      rp.items[itemIndex].input = val;

      if (hash === expectedHash && norm.length > 0){
        // correct
        rp.items[itemIndex].correct = true;
        saveState();
        // update UI: mark good, disable input and button
        statusEl.classList.add('good');
        statusEl.innerHTML = '✓';
        inputEl.disabled = true;
        checkBtnEl.disabled = true;
        inputEl.classList.remove('shake');
        inputEl.classList.add('pulse');
        setTimeout(() => inputEl.classList.remove('pulse'), 500);
        // In player mode, show the confirmed answer as the input value (normalized casing kept by original answer)
        // For clarity to player, set the visible text to the original canonical answer
        inputEl.value = ROUNDS[roundIndex].items[itemIndex].answer;
        // update scores
        updateScores();
        // If host is unlocked, show plaintext too
        if (state.hostUnlocked){
          hostAnswerEl.textContent = ROUNDS[roundIndex].items[itemIndex].answer;
        }
      } else {
        // incorrect
        rp.items[itemIndex].correct = false;
        saveState();
        // feedback
        statusEl.classList.remove('good');
        statusEl.classList.add('bad');
        statusEl.innerHTML = '✕';
        inputEl.classList.add('shake');
        setTimeout(() => {
          inputEl.classList.remove('shake');
          statusEl.classList.remove('bad');
          statusEl.innerHTML = '';
        }, 550);
      }
      updateScores();
    }

    function renderRound(){
      ensureProgressForRound(state.currentRound);
      // update headings / select / scores
      renderRoundSelector();
      updateScores();
      syncTimerUI();

      // mode hint
      modeHintEl.textContent = state.mode === 'host'
        ? 'Host mode — view answers and control rounds. Enter PIN to unlock host features.'
        : 'Type your guess and press Enter or tap Check. Correct answers lock in and increase your score.';

      // host panel visibility handled by updateHostPanelVisibility()

      // render rows
      rowsEl.innerHTML = '';
      const round = ROUNDS[state.currentRound];
      const rp = getRoundProgress(state.currentRound);
      for (let i = 0; i < round.items.length; i++){
        const progItem = rp.items[i] ? rp.items[i] : null;
        const row = renderRow(state.currentRound, i, round.items[i], progItem);
        rowsEl.appendChild(row);
      }
    }

    /* --- Auto-start timer when player starts typing into any answer field (global listener) --- */
    document.addEventListener('input', (e) => {
      // only in player mode and for text inputs
      if (state.mode !== 'player') return;
      const target = e.target;
      if (!target || target.tagName !== 'INPUT' || target.type !== 'text') return;
      // only respond if the input belongs to current round (we render only current round inputs)
      const prog = getRoundProgress(state.currentRound);
      if (!prog.timer.running){
        prog.timer.running = true;
        prog.timer.lastTick = Date.now();
        saveState();
        startTimerInterval();
        syncTimerUI();
      }
    });

    /* --- Host: render plain-text answer key for every round --- */
    function renderAnswers() {
      answersEl.innerHTML = ''; // clear
      for (let r = 0; r < ROUNDS.length; r++) {
        const round = ROUNDS[r];
        const card = document.createElement('div');
        card.className = 'answer-card';
        const title = document.createElement('h3');
        title.textContent = round.title || `Round ${r + 1}`;
        card.appendChild(title);
        const ul = document.createElement('ul');
        ul.className = 'answer-list';
        for (let i = 0; i < round.items.length; i++) {
          const li = document.createElement('li');
          const item = round.items[i];
          li.textContent = `${item.scramble} → ${item.answer}`;
          ul.appendChild(li);
        }
        card.appendChild(ul);
        answersEl.appendChild(card);
      }
    }

    /* --- Host unlock function (explicit PIN check) --- */
    function unlockHost() {
      const pin = (hostPinEl.value || '').trim();
      if (pin === HOST_PIN) {
        state.hostUnlocked = true;
        hostPinEl.value = '';
        hostStatusEl.textContent = 'Unlocked';
        jumpRoundBtn.disabled = false;
        showAllAnswersBtn.disabled = false;
        hostLogoutBtn.hidden = false;
        answersEl.classList.add('show');
        renderAnswers();
        saveState();
        updateHostPanelVisibility();
        renderRound();
        return;
      }
      // wrong pin feedback
      hostPinEl.classList.add('shake');
      setTimeout(() => hostPinEl.classList.remove('shake'), 400);
      hostStatusEl.textContent = 'Locked';
    }

    function updateHostPanelVisibility(){
      if (state.mode === 'host'){
        hostPanelEl.hidden = false;
        if (state.hostUnlocked){
          hostStatusEl.textContent = 'Unlocked';
          hostLogoutBtn.hidden = false;
          jumpRoundBtn.disabled = false;
          showAllAnswersBtn.disabled = false;
          answersEl.classList.add('show');
          renderAnswers();
        } else {
          hostStatusEl.textContent = 'Locked';
          hostLogoutBtn.hidden = true;
          jumpRoundBtn.disabled = true;
          showAllAnswersBtn.disabled = true;
          answersEl.classList.remove('show');
        }
      } else {
        hostPanelEl.hidden = true;
        answersEl.classList.remove('show');
      }
    }

    // =========================
    // INIT
    // =========================
    async function init(){
      // compute hashes (so validate works)
      await computeRoundHashes();

      // ensure progress structure exists
      for (let r = 0; r < ROUNDS.length; r++) {
        ensureProgressForRound(r);
      }

      // set DOM initial states
      renderRoundSelector();
      setRound(state.currentRound);
      setMode(state.mode);

      // restore timer if running
      const currentProg = getRoundProgress(state.currentRound);
      if (currentProg.timer && currentProg.timer.running){
        startTimerInterval();
      }
      syncTimerUI();
    }

    // run init on DOM ready
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
