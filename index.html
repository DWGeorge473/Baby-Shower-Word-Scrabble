<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Baby Word Scramble</title>

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Baloo+2:wght@500;700&family=Nunito:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#fff7fb;
      --bg2:#f3fbff;
      --ink:#1f2937;
      --muted:#6b7280;
      --card:#ffffff;
      --line:#e5e7eb;
      --pink:#ffb6d5;
      --pink2:#ffd3e6;
      --blue:#bfe8ff;
      --mint:#c8f7e7;
      --lav:#e7ddff;
      --good:#16a34a;
      --bad:#ef4444;
      --shadow: 0 18px 40px rgba(15,23,42,.10);
      --radius: 22px;
      --tap: 48px;
      --gutter: 24px;
      --max-content-width: 1400px;
    }

    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family: Nunito, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--ink);
      background:
        radial-gradient(1200px 700px at 15% 10%, var(--pink2), transparent 55%),
        radial-gradient(900px 600px at 85% 20%, var(--blue), transparent 55%),
        radial-gradient(900px 600px at 50% 95%, var(--mint), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
      overflow-x:hidden;
    }

    /* generous fixed top padding so header/timer are never hidden on phones */
    .app{
      min-height:100%;
      display:flex;
      align-items:flex-start;
      justify-content:center;
      padding: 40px var(--gutter) 48px;
      gap: 20px;
    }

    .shell{
      width:100%;
      max-width: var(--max-content-width);
      margin: 0 auto;
    }

    /* responsive layout: stacked on small, two-column on large */
    .layout{ display:block; gap:18px; }
    @media (min-width: 980px){
      .layout{
        display:grid;
        grid-template-columns: 1fr 420px; /* main / host */
        gap:24px;
        align-items:start;
      }
    }

    /* Top banner */
    .top-banner{
      position:relative;
      width:100%;
      height:108px;
      border-radius: 22px;
      background:
        linear-gradient(90deg, rgba(255,182,213,.95), rgba(191,232,255,.95), rgba(200,247,231,.95));
      box-shadow: var(--shadow);
      overflow:hidden;
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:20px 20px;
      border:1px solid rgba(255,255,255,.65);
      margin-bottom:18px;
    }

    .brand{ display:flex; gap:14px; align-items:center; }
    .brand-badge{ width:56px; height:56px; border-radius:14px; background: rgba(255,255,255,.9); display:grid; place-items:center; border:1px solid rgba(255,255,255,.8); box-shadow: 0 14px 26px rgba(15,23,42,.08); }
    .title-wrap{ line-height:1; }
    .title{ font-family:"Baloo 2", system-ui, sans-serif; font-size:22px; margin:0; }
    .subtitle{ margin:0; font-size:13px; color:rgba(31,41,55,.7); font-weight:700; }

    .mode-pill{ display:flex; gap:8px; align-items:center; padding:8px; background: rgba(255,255,255,.6); border:1px solid rgba(255,255,255,.65); border-radius:999px; }
    .chip{ border:0; background: transparent; padding: 8px 12px; border-radius: 999px; font-weight:800; color: rgba(31,41,55,.78); cursor:pointer; }
    .chip[aria-pressed="true"]{ background: rgba(255,255,255,.98); box-shadow: 0 10px 18px rgba(15,23,42,.09); color: var(--ink); }

    /* Main card */
    .onesie{ background: rgba(255,255,255,.92); border-radius: 20px; padding: 16px; box-shadow: var(--shadow); border:1px solid rgba(255,255,255,.75); }
    .onesie-inner{ padding: 10px; }
    .onesie-tabs{ display:flex; gap:12px; align-items:center; justify-content:space-between; flex-wrap:wrap; margin-bottom:8px; }
    .round-meta{ display:flex; gap:10px; align-items:center; flex-wrap:wrap; }
    .pill{ display:flex; gap:8px; align-items:center; padding:10px 12px; background: rgba(255,255,255,.96); border-radius:999px; font-weight:900; border:1px solid rgba(229,231,235,.95); }
    select{ border:0; background:transparent; font-weight:900; color:var(--ink); padding-right:18px; outline:none; }
    .btnrow{ display:flex; gap:10px; align-items:center; }
    .btn{ border:1px solid rgba(229,231,235,.95); background: rgba(255,255,255,.98); color: var(--ink); font-weight: 900; border-radius: 12px; padding:10px 12px; cursor:pointer; display:inline-flex; gap:8px; align-items:center; }
    .btn.primary{ background: linear-gradient(90deg, rgba(255,182,213,.9), rgba(191,232,255,.9)); }
    .btn.danger{ background: rgba(255,240,240,.92); border-color: rgba(239,68,68,.14); }

    .content{ padding: 6px 4px; }
    .hint{ color:var(--muted); font-weight:700; margin:0 0 10px; }

    .grid{ display:grid; gap:12px; }
    .row{ padding:12px; border-radius:12px; background: linear-gradient(180deg, rgba(255,255,255,.98), rgba(250,250,252,.98)); border:1px solid rgba(228,231,236,.9); display:flex; justify-content:space-between; gap:12px; align-items:center; flex-wrap:wrap; }

    /* Scramble font: larger, higher contrast, more letter spacing for clarity on all screens */
    .scramble code{
      font-family: "Baloo 2", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
      font-weight: 800;
      font-size: 18px;
      letter-spacing: 2px;
      padding:10px 14px;
      border-radius:12px;
      background: rgba(231,221,255,.35);
      border:1px solid rgba(107,114,128,.18);
      color: var(--ink);
      display:inline-block;
    }
    @media (min-width: 980px){
      .scramble code{ font-size:20px; letter-spacing:2.4px; padding:12px 16px; }
    }

    .answer{ display:flex; gap:10px; align-items:center; flex:1; min-width:160px; }
    input[type="text"]{ flex:1; padding:10px 12px; border-radius:10px; border:1px solid rgba(229,231,235,.95); font-weight:700; font-size:15px; min-height:44px; }
    input[disabled]{ background: rgba(245,245,246,.9); opacity:.9; }

    .status{ width:44px; height:44px; border-radius:12px; display:grid; place-items:center; border:1px solid rgba(229,231,235,.95); background: rgba(249,250,251,.96); font-weight:900; }
    .status.good{ border-color: rgba(22,163,74,.28); background: rgba(22,163,74,.06); color:var(--good); }
    .status.bad{ border-color: rgba(239,68,68,.28); background: rgba(239,68,68,.06); color:var(--bad); }

    .mini{ font-size:13px; color:var(--muted); font-weight:800; }

    .shake{ animation: shake .38s ease; }
    @keyframes shake{ 20%{ transform:translateX(-6px);} 40%{transform:translateX(6px);} 60%{transform:translateX(-4px);} 80%{transform:translateX(4px);} }
    .pulse{ animation: pulse .5s ease; }
    @keyframes pulse{ 0%{ box-shadow:0 0 0 0 rgba(22,163,74,.16);} 100%{ box-shadow:0 0 0 14px rgba(22,163,74,0);} }

    /* Host panel */
    .side{ display:block; }
    .host-panel{ background: linear-gradient(180deg, rgba(255,255,255,.98), rgba(250,250,252,.98)); border-radius:16px; padding:14px; border:1px solid rgba(229,231,235,.95); box-shadow: 0 12px 30px rgba(15,23,42,.06); min-height:160px; }
    .host-header{ display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:8px; }
    .host-actions{ display:flex; gap:8px; align-items:center; flex-wrap:wrap; }
    .host-round-nav{ display:flex; gap:8px; align-items:center; }
    .answers{ margin-top:10px; display:block; }
    .answer-card{ border-radius:12px; padding:12px; background: rgba(255,255,255,.96); border:1px solid rgba(229,231,235,.95); }
    .answer-list{ margin:0; padding-left:18px; font-weight:700; color:var(--ink); }

    /* Player-friendly side content (shown when host is not signed in) - no host instructions here */
    .player-side{
      display:flex;
      flex-direction:column;
      gap:10px;
      align-items:flex-start;
      padding:12px;
      border-radius:12px;
      background: rgba(255,255,255,.92);
      border:1px solid rgba(229,231,235,.95);
    }
    .player-side strong{ font-size:15px; }
    .player-side p{ margin:0; color:var(--muted); font-weight:700; }

    /* modal styles */
    .modal-backdrop{ position:fixed; inset:0; display:none; align-items:center; justify-content:center; background: rgba(10,10,10,.45); z-index:1200; }
    .modal-backdrop.show{ display:flex; }
    .modal{ width:min(480px,92%); background:#fff; border-radius:12px; padding:18px; box-shadow: 0 22px 60px rgba(2,6,23,.4); border:1px solid rgba(0,0,0,.06); }
    .modal h3{ margin:0 0 6px; }
    .modal p{ margin:0 0 12px; color:var(--muted); font-weight:700; }
    .modal .controls{ display:flex; gap:8px; margin-top:12px; justify-content:flex-end; }

    .welcome-title{ font-family:"Baloo 2", system-ui, sans-serif; font-size:18px; margin:0 0 8px; }
    .welcome-body{ color:var(--muted); font-weight:700; margin:0 0 12px; }

    @media (min-width:980px){
      .scramble code{ font-size:20px; letter-spacing:2.4px; padding:12px 16px; }
    }

    @media (prefers-reduced-motion: reduce){
      .shake,.pulse{ animation:none !important; }
    }
  </style>
</head>
<body>
  <main class="app" role="main">
    <div class="shell">

      <!-- header -->
      <header class="top-banner" aria-label="Baby Word Scramble header">
        <div class="brand">
          <div class="brand-badge" aria-hidden="true">
            <!-- baby icon -->
            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" width="38" height="38">
              <path d="M8 3.5c0 1.38 1.12 2.5 2.5 2.5h3C14.88 6 16 4.88 16 3.5" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round"/>
              <path d="M7 6.2 5.2 8c-.75.75-.75 1.97 0 2.72L7 12.5V19c0 1.66 1.34 3 3 3h4c1.66 0 3-1.34 3-3v-6.5l1.8-1.78c.75-.75.75-1.97 0-2.72L17 6.2" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round"/>
              <path d="M9.2 20.8c.4-1.2 1.5-2 2.8-2s2.4.8 2.8 2" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round"/>
              <path d="M10 14.5h4" stroke="#1F2937" stroke-width="1.7" stroke-linecap="round"/>
            </svg>
          </div>
          <div class="title-wrap">
            <h1 class="title">Baby Word Scramble</h1>
            <p class="subtitle">Fixed rounds · Player & Host modes</p>
          </div>
        </div>

        <div class="mode-pill" aria-label="Mode switch">
          <button id="playerBtn" class="chip" type="button" aria-pressed="true" title="Player mode">Player</button>
          <button id="hostBtn" class="chip" type="button" aria-pressed="false" title="Host mode (requires PIN)">Host</button>
        </div>
      </header>

      <!-- layout -->
      <div class="layout" role="region" aria-label="Game layout">

        <!-- main game column -->
        <section class="onesie" aria-label="Game card">
          <div class="onesie-inner">
            <div class="onesie-tabs">
              <div class="round-meta">
                <div class="pill" aria-label="Round selector">
                  <label for="roundSelect">Round</label>
                  <span class="select-wrap">
                    <select id="roundSelect" aria-label="Choose round"></select>
                  </span>
                </div>

                <div class="pill" aria-label="Round score">
                  <span class="score" id="scoreText">0 / 0 correct</span>
                </div>

                <div class="pill" aria-label="Total score">
                  <span class="score" id="totalScoreText">Total: 0 / 0</span>
                </div>

                <div class="pill" aria-label="Timer">
                  <span class="timer" id="timerText">⏱ 00:00</span>
                  <button class="btn" id="timerToggle" type="button" aria-label="Toggle timer" style="min-height:36px;padding:8px 10px;border-radius:999px;">
                    <span id="timerToggleText">Start</span>
                  </button>
                </div>
              </div>

              <div class="btnrow">
                <button class="btn" id="prevRound" type="button" title="Previous round">Previous</button>
                <button class="btn primary" id="nextRound" type="button" title="Next round">Next</button>
                <button class="btn danger" id="resetBtn" type="button" title="Reset my progress">Reset</button>
              </div>
            </div>

            <div class="content">
              <p class="hint" id="modeHint">Press Start to begin the round timer. Players type guesses and tap Check. Correct answers lock in and increase your score.</p>

              <!-- rows rendered here -->
              <div id="rows" class="grid" aria-live="polite"></div>

              <div class="footer" style="margin-top:14px; font-weight:700; color:var(--muted); display:flex; justify-content:space-between; gap:8px;">
                <span>Tip: Progress saves on this device.</span>
                <span></span>
              </div>
            </div>
          </div>
        </section>

        <!-- side column -->
        <aside class="side" aria-label="Side panel">
          <!-- Host panel (only visible when host signed in) -->
          <div class="host-panel" id="hostPanel" hidden>
            <div class="host-header">
              <div style="display:flex; flex-direction:column;">
                <strong style="font-size:15px;">Host Controls</strong>
                <span class="mini" id="hostStatus">Locked</span>
              </div>

              <div class="host-actions">
                <div class="host-round-nav" title="Navigate rounds">
                  <button class="btn" id="hostPrev" title="Prev round">◀ Prev</button>
                  <div style="min-width:120px; text-align:center; font-weight:900;" id="hostRoundLabel">Round 1</div>
                  <button class="btn" id="hostNext" title="Next round">Next ▶</button>
                </div>

                <button class="btn" id="hostLogout" hidden>Sign out</button>
              </div>
            </div>

            <div id="answers" class="answers" aria-label="Answer key"></div>
          </div>

          <!-- Player-side content (when host not signed-in): helpful, player-focused, no host instructions) -->
          <div class="player-side" id="playerSide">
            <strong>How to play</strong>
            <p>Tap Start to begin the round timer. Enter guesses for the scrambled words and tap Check or press Enter.</p>
            <p>Correct answers lock in. Your progress is saved locally — refresh to continue.</p>
            <div style="margin-top:8px; display:flex; gap:8px;">
              <button id="quickStart" class="btn primary">Quick Start</button>
              <button id="viewRules" class="btn">Rules</button>
            </div>
          </div>
        </aside>
      </div><!-- layout -->

    </div><!-- shell -->
  </main>

  <!-- Host PIN modal -->
  <div id="pinModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="pinTitle">
      <h3 id="pinTitle">Host Login</h3>
      <p>Enter the host PIN to reveal answers and host controls.</p>
      <div style="display:flex;gap:8px;align-items:center;">
        <input id="modalPinInput" type="password" inputmode="numeric" pattern="[0-9]*" placeholder="PIN" style="flex:1;padding:10px 12px;border-radius:8px;border:1px solid var(--line);font-weight:800;" />
        <button id="modalPinSubmit" class="btn primary">Unlock</button>
      </div>
      <div class="controls" style="margin-top:12px;">
        <button id="modalPinCancel" class="btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Welcome modal for players -->
  <div id="welcomeModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="welcomeTitle">
      <h3 id="welcomeTitle" class="welcome-title">Welcome — Baby Word Scramble</h3>
      <p class="welcome-body">Quick instructions for players:</p>
      <ul style="margin:0 0 12px 18px; color:var(--muted); font-weight:700;">
        <li>Press Start to begin the timer for this round.</li>
        <li>Type your guess for each scrambled word and press <strong>Check</strong> or Enter.</li>
        <li>Correct answers lock in and increase your score.</li>
      </ul>
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button id="welcomeClose" class="btn">Close</button>
        <button id="welcomeStart" class="btn primary">Start Round</button>
      </div>
    </div>
  </div>

  <!-- Optional rules modal -->
  <div id="rulesModal" class="modal-backdrop" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="rulesTitle">
      <h3 id="rulesTitle">Game Rules</h3>
      <p style="color:var(--muted); font-weight:700; margin:0 0 12px;">
        Short rules:
      </p>
      <ol style="margin:0 0 12px 18px; color:var(--muted); font-weight:700;">
        <li>Start the timer to begin the round.</li>
        <li>Each correct answer counts toward your round score.</li>
        <li>Your total accumulates across rounds and is shown in the header.</li>
      </ol>
      <div style="display:flex; gap:8px; justify-content:flex-end;">
        <button id="rulesClose" class="btn">Close</button>
      </div>
    </div>
  </div>

  <script>
    // CONFIG
    const HOST_PIN = "1979";
    const STORAGE_KEY = "baby_word_scramble_v5";

    // ROUNDS (unchanged)
    const ROUNDS = [
      { title:"Round 1", items:[
        {answer:"bottle", scramble:"OLTBTE"},
        {answer:"pacifier", scramble:"RAEICFIP"},
        {answer:"stroller", scramble:"RLETSORL"},
        {answer:"diapers", scramble:"SRPAEID"},
        {answer:"bib", scramble:"BBI"},
        {answer:"onesie", scramble:"EINOSE"},
        {answer:"baby shower", scramble:"YBAB WOSHER"},
        {answer:"rattle", scramble:"TLRTAE"},
        {answer:"teether", scramble:"REHTTEE"},
        {answer:"crib", scramble:"BIRC"},
        {answer:"swaddle", scramble:"DADSWEL"},
        {answer:"bassinet", scramble:"SENIABTS"}
      ]},
      { title:"Round 2", items:[
        {answer:"baby powder", scramble:"YBAB WOPDER"},
        {answer:"burp cloth", scramble:"BRPU HTLOC"},
        {answer:"nursery", scramble:"SURNREY"},
        {answer:"blanket", scramble:"KETLBAN"},
        {answer:"high chair", scramble:"GIHH RAHIC"},
        {answer:"binky", scramble:"NIBKY"},
        {answer:"booties", scramble:"EISBTOO"},
        {answer:"mittens", scramble:"TNEITSM"},
        {answer:"baby lotion", scramble:"YBAB NTOILO"},
        {answer:"changing pad", scramble:"GNIHCNA DAP"},
        {answer:"baby wipe", scramble:"YBAB PEWI"},
        {answer:"teddy bear", scramble:"DYTED EABR"}
      ]},
      { title:"Round 3", items:[
        {answer:"bottle warmer", scramble:"OTTLBE RMWRAE"},
        {answer:"baby monitor", scramble:"YBAB TINOMRO"},
        {answer:"rocking chair", scramble:"KCORIGN RAHIC"},
        {answer:"story book", scramble:"YRSTO OKBO"},
        {answer:"baby socks", scramble:"YBAB SKSOC"},
        {answer:"newborn", scramble:"WENOBRN"},
        {answer:"baby carrier", scramble:"YBAB RIRACRE"},
        {answer:"play mat", scramble:"YALP TAM"},
        {answer:"baby bath", scramble:"YBAB HTBA"},
        {answer:"breast pump", scramble:"TSABER PMUP"},
        {answer:"diaper bag", scramble:"RPAEDI GAB"},
        {answer:"nursing pillow", scramble:"SNIRUGN WOLIPL"}
      ]},
      { title:"Round 4", items:[
        {answer:"baby blanket", scramble:"YBAB KETLBAN"},
        {answer:"crib sheet", scramble:"BIRC TEESH"},
        {answer:"baby formula", scramble:"YBAB LMFRUAO"},
        {answer:"pacifier clip", scramble:"RAEICFIP PLIC"},
        {answer:"baby food", scramble:"YBAB ODFO"},
        {answer:"sippy cup", scramble:"YIPPS PCUP"},
        {answer:"bath toy", scramble:"HTBA YTO"},
        {answer:"diaper cream", scramble:"RPAEDI MRECAE"},
        {answer:"baby book", scramble:"YBAB KOBO"},
        {answer:"baby shower game", scramble:"YBAB WOSHER EMAG"},
        {answer:"cute outfit", scramble:"ETUC TUFIFO"},
        {answer:"sleep sack", scramble:"EESLP KCAKS"}
      ]},
      { title:"Round 5", items:[
        {answer:"baby name", scramble:"YBAB EMAN"},
        {answer:"pregnancy", scramble:"GNANCRYPE"},
        {answer:"ultrasound", scramble:"ASLUOTDNRU"},
        {answer:"tiny toes", scramble:"YINT OSET"},
        {answer:"first smile", scramble:"TSRIF LIMES"},
        {answer:"baby giggle", scramble:"YBAB GLGIGE"},
        {answer:"lullaby", scramble:"ALULBYL"},
        {answer:"twin stroller", scramble:"WINT RLETSORL"},
        {answer:"baby shower gifts", scramble:"YBAB WOSHER TSGIF"},
        {answer:"little one", scramble:"LTILE ENO"},
        {answer:"soft blanket", scramble:"TOSF KETLBAN"},
        {answer:"snuggle", scramble:"GLESGUN"}
      ]},
      { title:"Round 6", items:[
        {answer:"diaper rash", scramble:"RPAEDI HSRA"},
        {answer:"baby shampoo", scramble:"YBAB HSPMAOO"},
        {answer:"baby towel", scramble:"YBAB WELTO"},
        {answer:"hooded towel", scramble:"DOHDOE WELTO"},
        {answer:"washcloth", scramble:"HSLTAWCO"},
        {answer:"baby brush", scramble:"YBAB HRSUB"},
        {answer:"nail clippers", scramble:"LIAN PREPCLSI"},
        {answer:"thermometer", scramble:"RTEHMROMETE"},
        {answer:"baby oil", scramble:"YBAB LIO"},
        {answer:"gentle soap", scramble:"GTELNE PAOS"},
        {answer:"laundry", scramble:"NDYUARL"},
        {answer:"baby swing", scramble:"YBAB GNISW"}
      ]},
      { title:"Round 7", items:[
        {answer:"crib mobile", scramble:"BIRC BLEOMI"},
        {answer:"night light", scramble:"HITNG TGHLI"},
        {answer:"white noise", scramble:"EHWIT SIONE"},
        {answer:"baby mobile", scramble:"YBAB BLEOMI"},
        {answer:"baby pajamas", scramble:"YBAB SJAMYAP"},
        {answer:"sleepy baby", scramble:"EESLYP YBAB"},
        {answer:"nap time", scramble:"PAN EMIT"},
        {answer:"rock a bye", scramble:"KCOR A YEB"},
        {answer:"storybook", scramble:"YBOKRTSO"},
        {answer:"nursery rhyme", scramble:"SURNREY EHMRY"},
        {answer:"baby giggles", scramble:"YBAB SELGIGG"},
        {answer:"cuddle", scramble:"LDEUCD"}
      ]},
      { title:"Round 8", items:[
        {answer:"baby registry", scramble:"YBAB RIGTSYRE"},
        {answer:"baby shower invite", scramble:"YBAB WOSHER TEIINV"},
        {answer:"gift wrap", scramble:"TFGI PARW"},
        {answer:"thank you", scramble:"KHTNA UOY"},
        {answer:"party favors", scramble:"YRATP SROVFA"},
        {answer:"balloons", scramble:"SOOLNAB"},
        {answer:"decorations", scramble:"NOCORATSEDI"},
        {answer:"cupcake", scramble:"KACPCUE"},
        {answer:"cookies", scramble:"IESOKCO"},
        {answer:"baby shower cake", scramble:"YBAB WOSHER EKCA"},
        {answer:"photo booth", scramble:"TOHOP HTOOB"},
        {answer:"guess the baby", scramble:"SSEUG EHT YBAB"}
      ]},
      { title:"Round 9", items:[
        {answer:"baby shoes", scramble:"YBAB SOHES"},
        {answer:"baby hat", scramble:"YBAB ATH"},
        {answer:"baby mitts", scramble:"YBAB STTIM"},
        {answer:"baby blanket", scramble:"YBAB KETLBAN"},
        {answer:"baby bib", scramble:"YBAB BBI"},
        {answer:"baby wipes", scramble:"YBAB SEPIW"},
        {answer:"diaper pins", scramble:"RPAEDI SNIP"},
        {answer:"burp time", scramble:"BRPU EMIT"},
        {answer:"baby bottle", scramble:"YBAB OTLTBE"},
        {answer:"baby rattle", scramble:"YBAB TLRTAE"},
        {answer:"pacifier", scramble:"RAEICFIP"},
        {answer:"stroller", scramble:"RLETSORL"}
      ]},
      { title:"Round 10", items:[
        {answer:"baby laugh", scramble:"YBAB HGUAF"},
        {answer:"tiny hands", scramble:"YINT SDNAH"},
        {answer:"sweet dreams", scramble:"EETWS SREAMD"},
        {answer:"little star", scramble:"LTILE RATS"},
        {answer:"peek a boo", scramble:"KEPE A OBO"},
        {answer:"first steps", scramble:"TSRIF PSTES"},
        {answer:"bath time", scramble:"HTBA EMIT"},
        {answer:"snack time", scramble:"KCSAN EMIT"},
        {answer:"tummy time", scramble:"MYTUM EMIT"},
        {answer:"baby giggle", scramble:"YBAB GLGIGE"},
        {answer:"big hugs", scramble:"GIB SUGH"},
        {answer:"baby kisses", scramble:"YBAB SSEKIS"}
      ]},
      { title:"Round 11", items:[
        {answer:"baby carrier", scramble:"YBAB RIRACRE"},
        {answer:"car seat", scramble:"RAC TAES"},
        {answer:"stroller", scramble:"RLETSORL"},
        {answer:"baby gate", scramble:"YBAB TEAG"},
        {answer:"play pen", scramble:"YALP NEP"},
        {answer:"teething ring", scramble:"GNIEHTET GNIR"},
        {answer:"bath thermometer", scramble:"HTBA RTEHMROMETE"},
        {answer:"diaper genie", scramble:"RPAEDI EINNEG"},
        {answer:"baby swing", scramble:"YBAB GNISW"},
        {answer:"rocking horse", scramble:"KCORIGN ESROH"},
        {answer:"soft toy", scramble:"TOSF YTO"},
        {answer:"baby book", scramble:"YBAB KOBO"}
      ]},
      { title:"Round 12", items:[
        {answer:"baby shower", scramble:"YBAB WOSHER"},
        {answer:"new parents", scramble:"WEN SRETNAP"},
        {answer:"congratulations", scramble:"SNOITUTLARGACON"},
        {answer:"bundle of joy", scramble:"LEDNUB FO JOY"},
        {answer:"little miracle", scramble:"LTILE ELRACIM"},
        {answer:"welcome baby", scramble:"EMOCLEW YBAB"},
        {answer:"tiny fingers", scramble:"YINT SREGNIF"},
        {answer:"tiny toes", scramble:"YINT OSET"},
        {answer:"sweet baby", scramble:"EETWS YBAB"},
        {answer:"baby love", scramble:"YBAB EVOL"},
        {answer:"baby shower fun", scramble:"YBAB WOSHER NUF"},
        {answer:"little blessing", scramble:"LTILE GNSSIBLE"}
      ]}
    ];

    // UTIL functions
    function normalizeAnswer(str){
      return (str || "").toLowerCase().trim().replace(/\s+/g," ").replace(/[^a-z0-9 ]/g,"");
    }
    async function sha256Hex(str){
      const enc = new TextEncoder();
      const buf = enc.encode(str);
      const digest = await crypto.subtle.digest("SHA-256", buf);
      const bytes = new Uint8Array(digest);
      return [...bytes].map(b=>b.toString(16).padStart(2,"0")).join("");
    }
    let ROUND_HASHES = [];

    // STATE + STORAGE
    const defaultState = () => ({
      currentRound: 0,
      mode: "player",
      hostUnlocked: false,
      progress: {},
      seenWelcome: false
    });
    function loadState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultState();
        const parsed = JSON.parse(raw);
        if(typeof parsed !== "object" || parsed === null) return defaultState();
        return {...defaultState(), ...parsed};
      }catch{ return defaultState(); }
    }
    function saveState(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(state)); }
    let state = loadState();

    // TIMER
    let timerInterval = null;
    function getRoundProgress(roundIndex){
      if(!state.progress[roundIndex]) state.progress[roundIndex] = { items: {}, timer: { running:false, elapsedMs:0, lastTick: null } };
      return state.progress[roundIndex];
    }
    function formatTime(ms){
      const total = Math.max(0, Math.floor(ms/1000));
      const m = String(Math.floor(total/60)).padStart(2,"0");
      const s = String(total%60).padStart(2,"0");
      return `${m}:${s}`;
    }
    function syncTimerUI(){
      const prog = getRoundProgress(state.currentRound);
      document.getElementById("timerText").textContent = `⏱ ${formatTime(prog.timer.elapsedMs)}`;
      document.getElementById("timerToggleText").textContent = prog.timer.running ? "Pause" : "Start";
    }
    function stopTimerInterval(){ if(timerInterval) clearInterval(timerInterval); timerInterval=null; }
    function startTimerInterval(){
      stopTimerInterval();
      timerInterval = setInterval(() => {
        const prog = getRoundProgress(state.currentRound);
        if(!prog.timer.running) return;
        const now = Date.now();
        if(prog.timer.lastTick == null) prog.timer.lastTick = now;
        const dt = now - prog.timer.lastTick;
        prog.timer.lastTick = now;
        prog.timer.elapsedMs += dt;
        syncTimerUI();
        saveState();
      }, 250);
    }
    function toggleTimer(){
      const prog = getRoundProgress(state.currentRound);
      prog.timer.running = !prog.timer.running;
      prog.timer.lastTick = prog.timer.running ? Date.now() : null;
      syncTimerUI();
      saveState();
      if(prog.timer.running) startTimerInterval(); else stopTimerInterval();
    }
    function startTimerForCurrentRound(){
      const prog = getRoundProgress(state.currentRound);
      if(!prog.timer.running){
        prog.timer.running = true;
        prog.timer.lastTick = Date.now();
        saveState();
        startTimerInterval();
        syncTimerUI();
      }
    }

    // UI elements
    const rowsEl = document.getElementById("rows");
    const roundSelectEl = document.getElementById("roundSelect");
    const scoreTextEl = document.getElementById("scoreText");
    const totalScoreTextEl = document.getElementById("totalScoreText");
    const playerBtn = document.getElementById("playerBtn");
    const hostBtn = document.getElementById("hostBtn");
    const modeHintEl = document.getElementById("modeHint");
    const hostPanelEl = document.getElementById("hostPanel");
    const answersEl = document.getElementById("answers");
    const hostStatusEl = document.getElementById("hostStatus");
    const hostPrevBtn = document.getElementById("hostPrev");
    const hostNextBtn = document.getElementById("hostNext");
    const hostRoundLabel = document.getElementById("hostRoundLabel");
    const hostLogoutBtn = document.getElementById("hostLogout");
    const playerSide = document.getElementById("playerSide");

    // modal elements
    const pinModal = document.getElementById("pinModal");
    const modalPinInput = document.getElementById("modalPinInput");
    const modalPinSubmit = document.getElementById("modalPinSubmit");
    const modalPinCancel = document.getElementById("modalPinCancel");

    const welcomeModal = document.getElementById("welcomeModal");
    const welcomeStart = document.getElementById("welcomeStart");
    const welcomeClose = document.getElementById("welcomeClose");

    const rulesModal = document.getElementById("rulesModal");
    const rulesClose = document.getElementById("rulesClose");
    const quickStart = document.getElementById("quickStart");
    const viewRules = document.getElementById("viewRules");

    // Wiring top controls
    document.getElementById("prevRound").addEventListener("click", () => setRound(state.currentRound - 1));
    document.getElementById("nextRound").addEventListener("click", () => setRound(state.currentRound + 1));
    document.getElementById("resetBtn").addEventListener("click", resetProgress);
    document.getElementById("timerToggle").addEventListener("click", toggleTimer);

    playerBtn.addEventListener("click", () => setMode('player'));
    hostBtn.addEventListener("click", () => {
      if(state.hostUnlocked){ setMode('host'); return; }
      openPinModal();
    });

    roundSelectEl.addEventListener("change", (e) => setRound(parseInt(e.target.value, 10)));

    // Host side controls
    hostPrevBtn.addEventListener("click", () => setRound(state.currentRound - 1));
    hostNextBtn.addEventListener("click", () => setRound(state.currentRound + 1));
    hostLogoutBtn.addEventListener("click", () => {
      state.hostUnlocked = false;
      state.mode = 'player';
      saveState();
      updateHostPanelVisibility();
      renderRound();
      setMode('player');
    });

    // Modal handlers
    function openPinModal(){ pinModal.classList.add('show'); pinModal.setAttribute('aria-hidden', 'false'); modalPinInput.value=''; setTimeout(()=>modalPinInput.focus(),50); }
    function closePinModal(){ pinModal.classList.remove('show'); pinModal.setAttribute('aria-hidden', 'true'); modalPinInput.value=''; }
    modalPinCancel.addEventListener('click', closePinModal);
    modalPinInput.addEventListener('keydown', (e) => { if(e.key === 'Enter') modalPinSubmit.click(); if(e.key === 'Escape') closePinModal(); });
    modalPinSubmit.addEventListener('click', () => { const ok = processHostUnlock(modalPinInput.value.trim()); if(ok) closePinModal(); });

    // Welcome modal handlers
    function openWelcomeModal(){ welcomeModal.classList.add('show'); welcomeModal.setAttribute('aria-hidden', 'false'); setTimeout(()=> welcomeStart.focus(), 50); }
    function closeWelcomeModal(){ welcomeModal.classList.remove('show'); welcomeModal.setAttribute('aria-hidden', 'true'); }
    welcomeClose.addEventListener('click', () => { state.seenWelcome = true; saveState(); closeWelcomeModal(); });
    welcomeStart.addEventListener('click', () => { state.seenWelcome = true; saveState(); closeWelcomeModal(); setMode('player'); startTimerForCurrentRound(); });

    // Rules modal handlers
    viewRules.addEventListener('click', () => { rulesModal.classList.add('show'); rulesModal.setAttribute('aria-hidden', 'false'); });
    rulesClose.addEventListener('click', () => { rulesModal.classList.remove('show'); rulesModal.setAttribute('aria-hidden', 'true'); });
    quickStart.addEventListener('click', () => { if(!state.seenWelcome){ state.seenWelcome = true; saveState(); } setMode('player'); startTimerForCurrentRound(); });

    // RENDER / GAME LOGIC
    async function computeRoundHashes(){
      const all = [];
      for(let r=0;r<ROUNDS.length;r++){
        const hashes = [];
        for(let i=0;i<ROUNDS[r].items.length;i++){
          const norm = normalizeAnswer(ROUNDS[r].items[i].answer);
          hashes.push(await sha256Hex(norm));
        }
        all.push({ hashes });
      }
      ROUND_HASHES = all;
    }

    function ensureProgressForRound(r){ getRoundProgress(r); saveState(); }

    function setRound(i){
      if(i<0) i=0;
      if(i>=ROUNDS.length) i=ROUNDS.length-1;
      state.currentRound = i;
      saveState();
      renderRound();
      renderRoundSelector();
      syncTimerUI();
      updateHostPanelVisibility();
    }

    function setMode(mode){
      state.mode = mode === 'host' ? 'host' : 'player';
      playerBtn.setAttribute('aria-pressed', state.mode === 'player' ? 'true' : 'false');
      hostBtn.setAttribute('aria-pressed', state.mode === 'host' ? 'true' : 'false');
      updateHostPanelVisibility();
      saveState();
      renderRound();
    }

    function resetProgress(){
      if(!confirm('Reset all saved progress for this device?')) return;
      state = defaultState();
      saveState();
      renderRound();
      renderRoundSelector();
      updateScores();
      updateHostPanelVisibility();
      syncTimerUI();
    }

    function updateScores(){
      const prog = getRoundProgress(state.currentRound);
      const items = ROUNDS[state.currentRound].items.length;
      let correctThis = 0;
      if(prog && prog.items){
        Object.keys(prog.items).forEach(k => { if(prog.items[k] && prog.items[k].correct) correctThis++; });
      }
      scoreTextEl.textContent = `${correctThis} / ${items} correct`;

      let totalCorrect = 0, totalItems = 0;
      for(let r=0;r<ROUNDS.length;r++){
        totalItems += ROUNDS[r].items.length;
        const rp = state.progress[r];
        if(rp && rp.items) Object.keys(rp.items).forEach(k=>{ if(rp.items[k] && rp.items[k].correct) totalCorrect++; });
      }
      totalScoreTextEl.textContent = `Total: ${totalCorrect} / ${totalItems}`;
    }

    function renderRoundSelector(){
      if(roundSelectEl.children.length !== ROUNDS.length){
        roundSelectEl.innerHTML='';
        for(let i=0;i<ROUNDS.length;i++){
          const opt = document.createElement('option');
          opt.value = String(i);
          opt.textContent = ROUNDS[i].title || `Round ${i+1}`;
          roundSelectEl.appendChild(opt);
        }
      }
      roundSelectEl.value = String(state.currentRound);
    }

    function createStatusIcon(){ const wrap = document.createElement('div'); wrap.className='status'; return wrap; }

    // Player row with input
    function renderRowPlayer(rIndex, iIndex, item, progItem){
      const row = document.createElement('div'); row.className='row';
      const left = document.createElement('div'); left.style.display='flex'; left.style.flexDirection='column'; left.style.gap='8px'; left.style.flex='1';
      const scrambleWrap = document.createElement('div'); scrambleWrap.className='scramble';
      const code = document.createElement('code'); code.textContent = item.scramble; scrambleWrap.appendChild(code);

      const answerWrap = document.createElement('div'); answerWrap.className='answer';
      const input = document.createElement('input');
      input.type='text'; input.autocomplete='off'; input.spellcheck=false; input.placeholder='Type your guess';
      input.value = (progItem && progItem.input) ? progItem.input : '';
      input.dataset.itemIndex = String(iIndex);

      if(progItem && progItem.correct){ input.disabled = true; input.value = ROUNDS[rIndex].items[iIndex].answer; }

      const checkBtn = document.createElement('button'); checkBtn.className='btn'; checkBtn.type='button'; checkBtn.textContent='Check';
      if(progItem && progItem.correct) checkBtn.disabled = true;

      answerWrap.appendChild(input); answerWrap.appendChild(checkBtn);
      left.appendChild(scrambleWrap); left.appendChild(answerWrap);

      const right = document.createElement('div'); right.style.display='flex'; right.style.gap='8px'; right.style.alignItems='center';
      const status = createStatusIcon(); if(progItem && progItem.correct){ status.classList.add('good'); status.innerHTML='✓'; }
      right.appendChild(status);

      row.appendChild(left); row.appendChild(right);

      input.addEventListener('keydown', (ev) => { if(ev.key === 'Enter'){ ev.preventDefault(); checkAnswer(rIndex, iIndex, input, status, checkBtn); } });
      checkBtn.addEventListener('click', () => checkAnswer(rIndex, iIndex, input, status, checkBtn));

      return row;
    }

    // Host row: read-only, no input
    function renderRowHost(rIndex, iIndex, item){
      const row = document.createElement('div'); row.className='row';
      const left = document.createElement('div'); left.style.display='flex'; left.style.flexDirection='column'; left.style.gap='8px'; left.style.flex='1';
      const scrambleWrap = document.createElement('div'); scrambleWrap.className='scramble';
      const code = document.createElement('code'); code.textContent = item.scramble; scrambleWrap.appendChild(code);

      const answerText = document.createElement('div'); answerText.style.display='flex'; answerText.style.gap='12px'; answerText.style.alignItems='center';
      const label = document.createElement('div'); label.className='mini'; label.textContent='Answer:';
      const ans = document.createElement('div'); ans.style.fontWeight='900'; ans.textContent = item.answer;
      answerText.appendChild(label); answerText.appendChild(ans);

      left.appendChild(scrambleWrap); left.appendChild(answerText);

      const right = document.createElement('div'); right.style.display='flex'; right.style.gap='8px'; right.style.alignItems='center';
      const prog = state.progress[rIndex] && state.progress[rIndex].items && state.progress[rIndex].items[iIndex];
      const status = createStatusIcon(); if(prog && prog.correct){ status.classList.add('good'); status.innerHTML='✓'; }
      right.appendChild(status);

      row.appendChild(left); row.appendChild(right);
      return row;
    }

    async function checkAnswer(roundIndex, itemIndex, inputEl, statusEl, checkBtnEl){
      const val = inputEl.value || '';
      const norm = normalizeAnswer(val);
      const hash = await sha256Hex(norm);
      const expectedHash = ROUND_HASHES[roundIndex].hashes[itemIndex];

      const rp = getRoundProgress(roundIndex);
      if(!rp.items[itemIndex]) rp.items[itemIndex] = { input:'', correct:false };
      rp.items[itemIndex].input = val;

      if(hash === expectedHash && norm.length > 0){
        rp.items[itemIndex].correct = true;
        saveState();
        statusEl.classList.add('good'); statusEl.innerHTML='✓';
        inputEl.disabled = true; checkBtnEl.disabled = true;
        inputEl.classList.add('pulse'); setTimeout(()=>inputEl.classList.remove('pulse'),500);
        inputEl.value = ROUNDS[roundIndex].items[itemIndex].answer;
      } else {
        rp.items[itemIndex].correct = false;
        saveState();
        statusEl.classList.remove('good'); statusEl.classList.add('bad'); statusEl.innerHTML='✕';
        inputEl.classList.add('shake'); setTimeout(()=>{ inputEl.classList.remove('shake'); statusEl.classList.remove('bad'); statusEl.innerHTML=''; },550);
      }
      updateScores();
    }

    function renderRound(){
      ensureProgressForRound(state.currentRound);
      renderRoundSelector();
      updateScores();
      syncTimerUI();

      modeHintEl.textContent = state.mode === 'host'
        ? 'Host mode — viewing answers for the current round. Use Sign out to end host session.'
        : 'Press Start to begin the round timer. Type guesses and tap Check. Correct answers lock in and increase your score.';

      rowsEl.innerHTML = '';
      const round = ROUNDS[state.currentRound];
      const rp = getRoundProgress(state.currentRound);

      if(state.mode === 'host' && state.hostUnlocked){
        for(let i=0;i<round.items.length;i++) rowsEl.appendChild(renderRowHost(state.currentRound, i, round.items[i]));
      } else {
        for(let i=0;i<round.items.length;i++){
          const progItem = rp.items[i] ? rp.items[i] : null;
          rowsEl.appendChild(renderRowPlayer(state.currentRound, i, round.items[i], progItem));
        }
      }

      // update host panel if unlocked
      if(state.hostUnlocked) renderAnswers();
    }

    function renderAnswers(){
      answersEl.innerHTML = '';
      const round = ROUNDS[state.currentRound];
      const card = document.createElement('div'); card.className = 'answer-card';
      const title = document.createElement('h3'); title.textContent = round.title || `Round ${state.currentRound+1}`; card.appendChild(title);
      const ul = document.createElement('ul'); ul.className = 'answer-list';
      for(let i=0;i<round.items.length;i++){ const li = document.createElement('li'); li.textContent = `${round.items[i].scramble} → ${round.items[i].answer}`; ul.appendChild(li); }
      card.appendChild(ul); answersEl.appendChild(card);
      hostRoundLabel.textContent = `${round.title || 'Round ' + (state.currentRound+1)}`;
    }

    // Host unlock logic (modal)
    function processHostUnlock(pin){
      if((pin || '') === HOST_PIN){
        state.hostUnlocked = true;
        state.mode = 'host';
        saveState();
        updateHostPanelVisibility();
        renderRound();
        return true;
      }
      modalPinInput.classList.add('shake'); setTimeout(()=>modalPinInput.classList.remove('shake'),400);
      return false;
    }

    function updateHostPanelVisibility(){
      if(state.mode === 'host' && state.hostUnlocked){
        hostPanelEl.hidden = false; playerSide.hidden = true;
        hostStatusEl.textContent = 'Unlocked'; hostLogoutBtn.hidden = false; renderAnswers();
      } else {
        hostPanelEl.hidden = true; playerSide.hidden = false;
        hostLogoutBtn.hidden = true; hostStatusEl.textContent = 'Locked';
      }
      playerBtn.setAttribute('aria-pressed', state.mode === 'player' ? 'true' : 'false');
      hostBtn.setAttribute('aria-pressed', state.mode === 'host' ? 'true' : 'false');
    }

    // compute hashes and init
    async function initHashes(){ const arr = []; for(let r=0;r<ROUNDS.length;r++){ const hashes=[]; for(let i=0;i<ROUNDS[r].items.length;i++){ const norm = normalizeAnswer(ROUNDS[r].items[i].answer); hashes.push(await sha256Hex(norm)); } arr.push({hashes}); } ROUND_HASHES = arr; }

    function renderRoundSelector(){ if(roundSelectEl.children.length !== ROUNDS.length){ roundSelectEl.innerHTML=''; for(let i=0;i<ROUNDS.length;i++){ const opt = document.createElement('option'); opt.value = String(i); opt.textContent = ROUNDS[i].title || `Round ${i+1}`; roundSelectEl.appendChild(opt); } } roundSelectEl.value = String(state.currentRound); }

    async function init(){
      await initHashes();
      for(let r=0;r<ROUNDS.length;r++) ensureProgressForRound(r);
      renderRoundSelector();

      // restore persistent host login (if any)
      if(state.hostUnlocked) state.mode = 'host';
      else state.mode = 'player';

      setMode(state.mode);
      setRound(state.currentRound);

      // show welcome to players who haven't seen it and are not host
      if(!state.seenWelcome && !state.hostUnlocked) openWelcomeModal();

      // restore timer if running
      const prog = getRoundProgress(state.currentRound);
      if(prog.timer && prog.timer.running) startTimerInterval();
      syncTimerUI();
    }

    // modal submit wiring
    document.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>
